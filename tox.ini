# content of: tox.ini , put in same dir as setup.py
[tox]
envlist = {py36,py37,py38}-{test,mypy,flake8,cov}

[testenv]
setenv =
    PYTHONDONTWRITEBYTECODE=1

passenv =
    COVERALLS_REPO_TOKEN
    TRAVIS
    TRAVIS_*

changedir = 
    test: test
    mypy: src
    cov: test

deps = 
    {test,lint}: pydsdl==0.3.1
    test: pytest
    test: pytest-cov
    {py36,py37}-mypy: mypy
    flake8: flake8
    cov: coverage
    cov: coveralls

commands = 
    {py36,py37}-test: python -m pytest --basetemp={envtmpdir} -p "no:cacheprovider" --no-cov
    py38-test: python -m pytest --basetemp={envtmpdir} -p "no:cacheprovider" --cov=pydsdlgen --cov-append --cov-branch --cov-config={toxinidir}/setup.cfg
    {py36,py37}-mypy: mypy -m pydsdlgen --cache-dir {envtmpdir} --linecoverage-report {envtmpdir}/mypy-reports --config-file {toxinidir}/setup.cfg
    {py36,py37}-mypy: mypy dsdlgenj --cache-dir {envtmpdir} --linecoverage-report {envtmpdir}/mypy-reports --config-file {toxinidir}/setup.cfg
    flake8: flake8 --benchmark --tee --output-file={envtmpdir}/flake8.txt --filename=dsdlgenj,*.py --exclude=**/jinja2/*,**/markupsafe/* src
    py38-cov: - coverage html --rcfile={toxinidir}/setup.cfg -d .out-coverage
    py38-cov: - coveralls --rcfile={toxinidir}/setup.cfg

